<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Pixel Arena Duel</title>
<style>
body {margin:0;font-family:sans-serif;background:#111;color:#fff;display:flex;flex-direction:column;align-items:center;}
#menu,#arenaContainer{width:100%;max-width:800px;text-align:center;margin-top:20px;}
#arena {position:relative;width:800px;height:400px;background:#222;border:2px solid #555;}
.unit{position:absolute;width:40px;height:40px;border-radius:4px;text-align:center;line-height:40px;font-weight:bold;cursor:move;}
.tower{position:absolute;width:60px;height:60px;background:#555;text-align:center;line-height:60px;font-weight:bold;border-radius:6px;}
.obstacle{position:absolute;width:60px;height:60px;background:#888;border-radius:4px;}
.card{display:inline-block;width:80px;height:100px;background:#333;margin:5px;border-radius:6px;cursor:pointer;}
.card.selected{border:2px solid #0f0;}
#hud{margin-top:10px;}
</style>
</head>
<body>

<div id="menu">
<h1>Pixel Arena Duel</h1>
<input id="playerName" placeholder="Enter Your Name">
<div>
<h3>Select 3 Units:</h3>
<div id="cardsAvailable"></div>
</div>
<button id="hostBtn">Host Game</button>
<button id="joinBtn">Join Game</button>
<input id="peerIdInput" placeholder="Peer ID to join">
</div>

<div id="arenaContainer" style="display:none;">
<div id="hud">Energy: <span id="energyVal">5</span></div>
<div id="arena"></div>
<button id="resetBtn">Return to Menu</button>
</div>

<script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>
<script>
// -------------------- Unit Cards --------------------
const allCards=[
{name:"Tank",hp:200,atk:20,spd:10,color:"#0f0"},
{name:"Shooter",hp:80,atk:15,spd:20,color:"#f00"},
{name:"Healer",hp:50,atk:0,spd:15,color:"#00f"}
];

let selectedDeck=[];
const cardsAvailableDiv=document.getElementById("cardsAvailable");
allCards.forEach(c=>{
  let div=document.createElement("div");
  div.className="card";
  div.style.background=c.color;
  div.innerHTML=c.name;
  div.onclick=()=>{
    if(selectedDeck.includes(c)){selectedDeck=selectedDeck.filter(u=>u!==c);div.classList.remove("selected");}
    else if(selectedDeck.length<3){selectedDeck.push(c);div.classList.add("selected");}
  };
  cardsAvailableDiv.appendChild(div);
});

// -------------------- Multiplayer Setup --------------------
let peer, conn;
const playerNameInput=document.getElementById("playerName");
document.getElementById("hostBtn").onclick=()=>{
  peer=new Peer();
  peer.on('open', id=>{
    alert("Hosting! Your Peer ID: "+id);
    setupGame(true);
  });
  peer.on('connection', c=>{
    conn=c;
    conn.on('data', handleData);
  });
};
document.getElementById("joinBtn").onclick=()=>{
  peer=new Peer();
  const peerId=document.getElementById("peerIdInput").value;
  conn=peer.connect(peerId);
  conn.on('open', ()=>{setupGame(false);});
  conn.on('data', handleData);
};

// -------------------- Game --------------------
const arena=document.getElementById("arena");
let state={units:[],energy:5,running:true};
let obstacles=[];

function setupGame(isHost){
  document.getElementById("menu").style.display="none";
  document.getElementById("arenaContainer").style.display="block";
  createObstacles();
  setInterval(()=>{if(state.energy<10){state.energy+=1;document.getElementById("energyVal").innerText=state.energy;}},1000);
}

function createObstacles(){
  obstacles.push({x:370,y:170,width:60,height:60});
  obstacles.forEach(o=>{
    let div=document.createElement("div");
    div.className="obstacle";
    div.style.left=o.x+"px"; div.style.top=o.y+"px";
    arena.appendChild(div);
  });
}

function spawnUnit(card,x,y,isRemote=false){
  let div=document.createElement("div");
  div.className="unit";
  div.style.left=x+"px"; div.style.top=y+"px";
  div.style.background=card.color;
  div.innerText=card.name[0];
  div.hp=card.hp; div.atk=card.atk; div.spd=card.spd;
  arena.appendChild(div);
  state.units.push(div);
  moveUnit(div);
  if(!isRemote && conn) conn.send({type:"spawn",card:card.name,x:x,y:y});
}

function moveUnit(unit){
  const interval=setInterval(()=>{
    if(!state.running) clearInterval(interval);
    unit.style.left=parseFloat(unit.style.left)+unit.spd*0.3+"px";
    if(parseFloat(unit.style.left)>arena.clientWidth) {unit.remove(); state.units=state.units.filter(u=>u!==unit);}
  },50);
}

// -------------------- Drag to Spawn --------------------
arena.ondragover=e=>e.preventDefault();
arena.ondrop=e=>{
  e.preventDefault();
  let typeName=e.dataTransfer.getData("text/plain");
  let card=allCards.find(c=>c.name===typeName);
  if(!card||state.energy<2) return;
  let rect=arena.getBoundingClientRect();
  let dropX=e.clientX-rect.left, dropY=e.clientY-rect.top;
  if(dropY>arena.clientHeight/2){spawnUnit(card,dropX,dropY);}
  state.energy-=2; document.getElementById("energyVal").innerText=state.energy;
};

// Make deck draggable
const deckDivs=document.querySelectorAll(".card");
deckDivs.forEach((div,i)=>{
  div.draggable=true;
  div.ondragstart=e=>e.dataTransfer.setData("text/plain",selectedDeck[i].name);
});

// -------------------- Handle Incoming Data --------------------
function handleData(data){
  if(data.type==="spawn"){
    const card=allCards.find(c=>c.name===data.card);
    spawnUnit(card,data.x,data.y,true);
  }
}

document.getElementById("resetBtn").onclick=()=>{location.reload();}
</script>
</body>
</html>
