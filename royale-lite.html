<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Royale Lite – Full Version</title>
<style>
  body{margin:0;font-family:sans-serif;background:#071023;color:#fff;}
  #arena{position:relative;width:100%;height:400px;background:#0b1a2b;margin-bottom:10px;}
  .tower,.kingTower{position:absolute;width:72px;height:72px;background:#2a3140;border-radius:8px;text-align:center;line-height:72px;font-weight:bold;}
  .kingTower{width:96px;height:96px;line-height:96px;}
  #leftTowerTop{top:10px;left:10px;} #rightTowerTop{top:10px;right:10px;}
  #leftTowerBot{bottom:10px;left:10px;} #rightTowerBot{bottom:10px;right:10px;}
  #leftKingTower{left:10px;top:50%;transform:translateY(-50%);background:#3a2b40;}
  #rightKingTower{right:10px;top:50%;transform:translateY(-50%);background:#3a2b40;}
  .unit{position:absolute;width:40px;height:40px;background:#36b37e;border-radius:6px;text-align:center;line-height:40px;font-weight:bold;cursor:move;}
  #deck{display:flex;gap:5px;margin-bottom:10px;}
  .card{width:60px;height:60px;background:#1f2937;border-radius:6px;text-align:center;line-height:60px;cursor:pointer;}
  #hud{margin-bottom:10px;}
  #upgrades{margin-top:10px;}
  .upgradeCard{display:inline-block;width:60px;height:60px;margin:2px;text-align:center;line-height:20px;background:#222;border-radius:6px;cursor:pointer;font-size:12px;}
</style>
<script src="https://cdn.jsdelivr.net/npm/peerjs@1.5.3/dist/peerjs.min.js"></script>
</head>
<body>

<h2>Royale Lite – Full Version</h2>

<div id="hud">
  Elixir: <span id="elixirVal">5</span> | Reward Points: <span id="points">0</span> | Rank: <span id="rank">Bronze 0</span>
</div>

<div id="deck"></div>
<div id="arena">
  <div class="tower" id="leftTowerTop">LT</div>
  <div class="tower" id="rightTowerTop">RT</div>
  <div class="tower" id="leftTowerBot">LB</div>
  <div class="tower" id="rightTowerBot">RB</div>
  <div class="kingTower" id="leftKingTower">LK</div>
  <div class="kingTower" id="rightKingTower">RK</div>
</div>

<button id="resetBtn">Reset Game</button>

<div id="upgrades">
<h3>Card Upgrades</h3>
<div id="upgradePanel"></div>
</div>

<div id="multiplayer">
<h3>PeerJS Multiplayer</h3>
Your ID: <input id="myId" readonly>
<button id="generateId">Generate ID</button><br>
Connect to Peer: <input id="peerId"><button id="connectPeer">Connect</button>
<div id="log" style="height:100px;overflow:auto;background:#111;margin-top:5px;padding:2px;"></div>
</div>

<script>
/* Basic Game State */
let state={units:[],towers:{leftTop:1000,rightTop:1000,leftBot:1000,rightBot:1000,leftKing:2000,rightKing:2000},elixir:5,points:0,running:true,rankPoints:0};
let deck=["spear","archer","giant","knight","mage","dragon","bomber","archer"];
let cardLevels=JSON.parse(localStorage.getItem("cardLevels")||"{}");

/* Unit Types with upgrade multipliers */
const UNIT_TYPES={
  spear:{hp:80,atk:30,spd:40,cost:2},
  archer:{hp:60,atk:25,spd:55,cost:3},
  giant:{hp:420,atk:70,spd:18,cost:6},
  knight:{hp:200,atk:50,spd:25,cost:4},
  mage:{hp:100,atk:60,spd:30,cost:5},
  dragon:{hp:600,atk:90,spd:15,cost:8},
  bomber:{hp:120,atk:70,spd:20,cost:4}
};

/* Init Deck UI */
function setupDeck(){
  let deckDiv=document.getElementById("deck"); deckDiv.innerHTML="";
  deck.forEach(c=>{
    let card=document.createElement("div");
    card.className="card"; card.innerText=c.charAt(0).toUpperCase();
    card.draggable=true;
    card.ondragstart=e=>e.dataTransfer.setData("text/plain",c);
    deckDiv.appendChild(card);
  });
}
setupDeck();

/* Spawn Units */
const arena=document.getElementById("arena");
arena.ondragover=e=>e.preventDefault();
arena.ondrop=e=>{
  e.preventDefault();
  let type=e.dataTransfer.getData("text/plain");
  if(state.elixir<UNIT_TYPES[type].cost)return;
  let rect=arena.getBoundingClientRect();
  spawnUnit(type,e.clientX-rect.left,e.clientY-rect.top);
  state.elixir-=UNIT_TYPES[type].cost;
  document.getElementById("elixirVal").innerText=Math.floor(state.elixir);
  cycleDeck(type);
};

function spawnUnit(type,x,y){
  let lvl=cardLevels[type]||1;
  let u=UNIT_TYPES[type];
  state.units.push({type,x,y,hp:u.hp*lvl,atk:u.atk*lvl,spd:u.spd});
  renderUnits();
}

/* Render Units */
function renderUnits(){
  let udiv=document.getElementById("arena");
  state.units.forEach(u=>{
    if(!u.div){
      let d=document.createElement("div"); d.className="unit"; d.innerText=u.type[0].toUpperCase();
      arena.appendChild(d); u.div=d;
    }
    u.div.style.left=u.x+"px"; u.div.style.top=u.y+"px";
  });
}

/* Cycle deck */
function cycleDeck(type){
  deck.push(deck.splice(deck.indexOf(type),1)[0]);
  setupDeck();
}

/* Simple game loop */
function loop(){
  if(!state.running)return;
  state.units.forEach(u=>{
    u.x+=1; // move right
  });
  renderUnits();
  requestAnimationFrame(loop);
}
loop();

/* Upgrades */
const upgradePanel=document.getElementById("upgradePanel");
function setupUpgrades(){
  upgradePanel.innerHTML="";
  Object.keys(UNIT_TYPES).forEach(c=>{
    let lvl=cardLevels[c]||1;
    let div=document.createElement("div"); div.className="upgradeCard";
    div.innerHTML=c.charAt(0).toUpperCase()+"<br>Lv "+lvl+"<br>Cost "+lvl*5;
    div.onclick=()=>{if(state.points>=lvl*5){state.points-=lvl*5;cardLevels[c]=lvl+1;localStorage.setItem("cardLevels",JSON.stringify(cardLevels));setupUpgrades();document.getElementById("points").innerText=state.points;}}
    upgradePanel.appendChild(div);
  });
}
setupUpgrades();

/* Reset */
document.getElementById("resetBtn").onclick=()=>{
  state.units=[];state.towers={leftTop:1000,rightTop:1000,leftBot:1000,rightBot:1000,leftKing:2000,rightKing:2000};
  state.elixir=5;document.getElementById("elixirVal").innerText=state.elixir;renderUnits();
}

/* PeerJS Multiplayer */
let peer=null,conn=null;
document.getElementById("generateId").onclick=()=>{
  peer=new Peer();peer.on('open',id=>document.getElementById("myId").value=id);
  peer.on('connection',c=>{conn=c;c.on('data',handleData);});
}
document.getElementById("connectPeer").onclick=()=>{
  conn=peer.connect(document.getElementById("peerId").value);conn.on('open',()=>{conn.on('data',handleData);});
}
function handleData(d){if(d.type==="spawn")spawnUnit(d.unit.type,d.unit.x,d.unit.y);}

/* Ranked system */
function updateRank(){
  let p=state.rankPoints;
  let tier="Bronze";
  if(p>=100) tier="Silver";
  if(p>=200) tier="Gold";
  if(p>=400) tier="Platinum";
  document.getElementById("rank").innerText=tier+" "+p;
}
updateRank();
</script>

</body>
</html>
